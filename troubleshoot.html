<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Troubleshoot Mi Nikon</title>
    <style>
        body {
            background: #222;
            color: #eee;
            font-family: sans-serif;
            padding: 2rem;
        }

        .status {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .success {
            background: #155724;
            color: #d4edda;
        }

        .error {
            background: #721c24;
            color: #f8d7da;
        }

        code {
            background: #111;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <h1>Calculated Status</h1>

    <div style="margin-bottom: 2rem; background: #333; padding: 1rem; border-radius: 8px;">
        <h3>Configuration</h3>
        <label style="display:block; margin-bottom: 0.5rem">Supabase URL:</label>
        <input type="text" id="url-input"
            style="width: 100%; padding: 0.5rem; margin-bottom: 1rem; background: #111; border: 1px solid #555; color: white;"
            placeholder="https://..." />

        <label style="display:block; margin-bottom: 0.5rem">Supabase Anon Key:</label>
        <input type="text" id="key-input"
            style="width: 100%; padding: 0.5rem; margin-bottom: 1rem; background: #111; border: 1px solid #555; color: white;"
            placeholder="sb_..." />

        <button onclick="runTest()"
            style="padding: 0.8rem 1.5rem; background: #f2c10d; color: black; border: none; font-weight: bold; cursor: pointer; border-radius: 4px;">Test
            Connection</button>
    </div>

    <div id="status-container" style="display: none;">
        <h3>Results</h3>
        <div id="supabase-status" class="status">Waiting to test...</div>
    </div>

    <script type="module">
        import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

        window.runTest = async () => {
            const url = document.getElementById('url-input').value.trim();
            const key = document.getElementById('key-input').value.trim();
            const statusContainer = document.getElementById('status-container');
            const statusEl = document.getElementById('supabase-status');

            if (!url || !key) {
                alert("Please enter both URL and Key");
                return;
            }

            statusContainer.style.display = 'block';
            statusEl.textContent = "Connecting...";
            statusEl.className = 'status';

            try {
                const supabase = createClient(url, key);

                // 1. Check Connection & Table Existence
                const { data, error } = await supabase.from('profiles').select('count', { count: 'exact', head: true });

                if (error) {
                    statusEl.textContent = 'Connection Failed or Table Missing: ' + error.message;
                    statusEl.className = 'status error';
                    if (error.code === '42P01') {
                        statusEl.textContent += ' (Error 42P01 confirms the table "profiles" does not exist via the API)';
                    }
                } else {
                    statusEl.textContent = 'Connection Successful! "profiles" table exists.';
                    statusEl.className = 'status success';
                }
            } catch (err) {
                statusEl.textContent = 'Client Error: ' + err.message;
                statusEl.className = 'status error';
            }
        };
    </script>
</body>

</html>